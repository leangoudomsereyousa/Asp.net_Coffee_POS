@{
    Layout = "_Layout";
    ViewData["Title"] = "Review";
}

<section id="review" class="min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900 py-16">
    <div class="container mx-auto px-4">
        <div class="max-w-md mx-auto">

            <!-- Title -->
            <div class="text-center mb-10">
                <h2 class="text-4xl font-semibold text-gray-900 dark:text-white mb-2">Leave a Review</h2>
                <p class="text-gray-600 dark:text-gray-300">Share your Café MUY experience.</p>
            </div>

            <!-- Card -->
            <div class="bg-white dark:bg-green-900 rounded-3xl shadow-xl p-8 md:p-10 transition-transform hover:-translate-y-1 hover:shadow-2xl">

                <!-- Validation Errors -->
                @if (!ViewData.ModelState.IsValid && ViewData.ModelState.Values.Any(v => v.Errors.Count > 0))
                {
                    <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-6">
                        <ul class="list-disc list-inside">
                            @foreach (var state in ViewData.ModelState.Values)
                            {
                                foreach (var error in state.Errors)
                                {
                                    <li>@error.ErrorMessage</li>
                                }
                            }
                        </ul>
                    </div>
                }

                <form asp-action="AddReview" method="post">
                    @Html.AntiForgeryToken()

                    <!-- Name -->
                    <div class="mb-6">
                        <label class="block text-gray-800 dark:text-gray-200 font-medium mb-2">Your Name</label>
                        <input type="text" name="Name" placeholder="Enter your name" required
                               class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-green-700 focus:ring-2 focus:ring-green-600 focus:outline-none dark:bg-green-800 dark:text-white text-gray-900" />
                    </div>

                    <!-- Apple-style Interactive Stars -->
                    <div class="mb-6 text-center">
                        <label class="block text-gray-800 dark:text-gray-200 font-medium mb-2">Rating</label>
                        <div class="flex justify-center items-center gap-2 star-wrapper">
                            <div class="flex stars gap-2 cursor-pointer">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    <svg class="star w-10 h-10 text-gray-300 dark:text-gray-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                                    </svg>
                                }
                            </div>
                            <span id="rating-value" class="ml-4 text-lg font-semibold text-gray-800 dark:text-gray-200">0/5</span>
                        </div>
                        <input type="hidden" name="Rating" id="hiddenRating" value="0" />
                    </div>

                    <!-- Review -->
                    <div class="mb-8">
                        <label class="block text-gray-800 dark:text-gray-200 font-medium mb-2">Your Review</label>
                        <textarea name="Subject" rows="5" placeholder="Write your review here..." required
                                  class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-green-700 focus:ring-2 focus:ring-green-600 focus:outline-none dark:bg-green-800 dark:text-white text-gray-900"></textarea>
                    </div>

                    <!-- Buttons -->
                    <div class="flex flex-col md:flex-row gap-4">
                        <button type="submit" class="flex-1 bg-green-700 hover:bg-green-800 text-white font-medium py-3 rounded-xl transition-all shadow-md">
                            Submit Review
                        </button>
                        <a asp-action="UserDashboard" asp-controller="User"
                           class="flex-1 border border-gray-300 hover:bg-gray-100 dark:border-green-600 dark:hover:bg-green-800 text-gray-900 dark:text-gray-200 font-medium py-3 rounded-xl text-center transition-all shadow-md">
                            Back
                        </a>
                    </div>

                </form>
            </div>
        </div>
    </div>
</section>

<style>
    .star-wrapper .star {
        color: #d1d5db; /* gray default */
        transition: color 0.3s ease, transform 0.2s ease;
    }

        .star-wrapper .star:hover,
        .star-wrapper .star.hovered {
            color: #00704A; /* Starbucks Green / Apple style highlight */
            transform: scale(1.2);
        }

    .star-selected {
        color: #00704A !important;
    }
</style>

<script>
    const stars = document.querySelectorAll('.star-wrapper .star');
    const ratingValue = document.getElementById('rating-value');
    const hiddenRating = document.getElementById('hiddenRating');

    let currentRating = 0;

    // Update star fill based on currentRating
    function updateStars() {
        stars.forEach((star, idx) => {
            if (idx < currentRating) {
                star.classList.add('star-selected');
            } else {
                star.classList.remove('star-selected');
            }
            star.classList.remove('hovered');
        });
        ratingValue.textContent = `${currentRating}/5`;
        hiddenRating.value = currentRating;
    }

    // Hover effect
    stars.forEach((star, index) => {
        star.addEventListener('mouseenter', () => {
            stars.forEach((s, i) => {
                s.classList.toggle('hovered', i <= index);
            });
            ratingValue.textContent = `${index + 1}/5`;
        });

        star.addEventListener('mouseleave', updateStars);

        star.addEventListener('click', () => {
            currentRating = index + 1;
            updateStars();
        });
    });

    // Initialize
    updateStars();
</script>
